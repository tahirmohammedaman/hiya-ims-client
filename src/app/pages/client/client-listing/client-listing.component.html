<div class="card mb-5 mb-xl-8">
  <!-- begin::Header -->
  <div class="card-header border-0 pt-5">
    <h3 class="card-title align-items-start flex-column">
      <span class="card-label fw-bolder fs-3 mb-1">Clients</span>
      <!-- <span class="text-muted mt-1 fw-bold fs-7">Over 500 orders</span> -->
    </h3>
    <div class="card-toolbar">
      <a class="btn btn-sm btn-light-primary m-2" (click)="openModal()">
        <span [inlineSVG]="'./assets/media/icons/duotune/arrows/arr075.svg'" class="svg-icon svg-icon-3"></span>
        Add Client
      </a>
      <!-- begin::Menu -->
      <button type="button" class="btn btn-sm btn-icon btn-color-primary btn-active-light-primary"
        data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end" data-kt-menu-flip="top-end">
        <app-keenicon name="category" class="fs-2"></app-keenicon>
      </button>
      <!-- begin::Menu 2 -->
      <!-- TODO: Use dropdown -->
      <!-- <app-dropdown-menu2></app-dropdown-menu2> -->
      <!-- end::Menu 2 -->
      <!-- end::Menu -->
    </div>
  </div>
  <!-- end::Header -->
  <!-- begin::Body -->
  <div class="card-body py-3">
    <!-- begin::Table container -->
    <div class="table-responsive">
      <!-- begin::Table -->
      <table class="table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3">
        <!-- begin::Table head -->
        <thead>
          <tr class="fw-bolder text-muted">
            <th class="w-25px"></th>
            <th class="w-25px"></th>
            <th class="min-w-150px">Name</th>
            <th class="min-w-120px">Contact Person</th>
            <th class="min-w-120px">Phone Number</th>
            <th class="min-w-120px">Created At</th>
            <th class="min-w-100px text-end">Actions</th>
          </tr>
        </thead>
        <!-- end::Table head -->
        <!-- begin::Table body -->
        <tbody>
          <ng-content *ngFor="let client of clients; let i = index">
            <tr>
              <td>
                <a class="btn btn-icon btn-active-color-primary btn-sm me-1" (click)="toggleRow(i)">
                  <app-keenicon name="down" class="fs-3" *ngIf="expandedRow != i"></app-keenicon>
                  <app-keenicon name="up" class="fs-3" *ngIf="expandedRow == i"></app-keenicon>
                </a>
              </td>
              <td>
                <a class="text-gray-900 fw-bolder text-hover-primary fs-6">
                  {{ i + 1 }}
                </a>
              </td>
              <td>
                <a class="text-gray-900 fw-bolder text-hover-primary fs-6">
                  {{ client.name }}
                </a>
              </td>
              <td class="text-gray-900 fw-bolder text-hover-primary fs-6">
                {{ client.contactPerson }}
              </td>
              <td class="text-gray-900 fw-bolder text-hover-primary fs-6">
                {{ client.primaryPhoneNumber }}
                <span class="text-muted fw-bold text-muted d-block fs-6">
                  {{ client.secondaryPhoneNumber }}
                </span>
              </td>
              <td>
                <a class="text-gray-900 fw-bolder text-hover-primary d-block mb-1 fs-6">
                  {{ client.createdAt | date: 'mediumDate' }}
                </a>
              </td>
              <td class="text-end">
                <a class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1" (click)="openModal(client)">
                  <app-keenicon name="pencil" class="fs-3"></app-keenicon>
                </a>
                <a class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm" (click)="confirmDelete(client.id)">
                  <app-keenicon name="trash" class="fs-3"></app-keenicon>
                </a>
              </td>
            </tr>

            <!-- Collapsable -->
            <tr>
              <td colspan="7" #collapse="ngbCollapse" [animation]="false" [ngbCollapse]="expandedRow != i">
                <div class="w-75 mx-auto row">
                  <div class="col-xs-12 col-sm-4">
                    <div class="my-5">
                      <p class="text-gray-900 fw-bolder d-block mb-1 fs-6 mb-5">
                        <span class="fw-bolder text-muted">TIN: </span> {{ client.TIN }}
                      </p>
                      <p class="text-gray-900 fw-bolder d-block mb-1 fs-6 mb-5">
                        <span class="fw-bolder text-muted">Email: </span> {{ client.email }}
                      </p>
                      <p class="text-gray-900 fw-bolder d-block mb-1 fs-6 mb-5">
                        <span class="fw-bolder text-muted">City: </span> {{ client.city }}
                      </p>
                      <p class="text-gray-900 fw-bolder d-block mb-1 fs-6 mb-5">
                        <span class="fw-bolder text-muted">Sub City: </span> {{ client.subCity }}
                      </p>
                      <p class="text-gray-900 fw-bolder d-block mb-1 fs-6 mb-5">
                        <span class="fw-bolder text-muted">Woreda: </span> {{ client.woreda }}
                      </p>
                      <p class="text-gray-900 fw-bolder d-block mb-1 fs-6 mb-5">
                        <span class="fw-bolder text-muted">House Number: </span> {{ client.houseNumber }}
                      </p>
                    </div>
                  </div>
                  <div class="col-xs-12 col-sm-8">
                    <div class="table-responsive my-5">
                      <h3 class="card-title align-items-start flex-column">
                        <span class="card-label text-muted fw-bolder fs-6 mb-1">Client Files</span>
                      </h3>
                      <!-- begin::Table -->
                      <table class="table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3">
                        <!-- begin::Table head -->
                        <thead>
                          <tr class="fw-bolder text-muted">
                            <th class="w-25px"></th>
                            <th class="min-w-150px">Filename</th>
                            <th class="min-w-100px">Actions</th>
                          </tr>
                        </thead>
                        <!-- end::Table head -->
                        <!-- begin::Table body -->
                        <tbody>
                          <ng-content *ngFor="let file of client.files">
                            <tr>
                              <td>
                                <a class="text-gray-900 fw-bolder text-hover-primary fs-6">
                                  â€¢
                                </a>
                              </td>
                              <td>
                                <a class="text-gray-900 fw-bolder text-hover-primary fs-6">
                                  {{ getDisplayFilename(file) || file }}
                                </a>
                              </td>
                              <td>
                                <a class="text-gray-900 fw-bolder text-hover-primary fs-6">
                                  <a class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm me-1" [href]="getStaticUrl(file)" target="_blank">
                                    <app-keenicon name="eye" class="fs-3"></app-keenicon>
                                  </a>
                                  <a class="btn btn-icon btn-bg-light btn-active-color-primary btn-sm" (click)="confirmDeleteFile(client.id, file)">
                                    <app-keenicon name="trash" class="fs-3"></app-keenicon>
                                  </a>
                                </a>
                              </td>
                            </tr>
                          </ng-content>
                        </tbody>
                        <!-- end::Table body -->
                      </table>
                      <!-- end::Table -->
                    </div>
                  </div>
                </div>
              </td>
            </tr>

          </ng-content>
        </tbody>
        <!-- end::Table body -->
      </table>
      <!-- end::Table -->
    </div>
    <!-- end::Table container -->
  </div>
  <!-- begin::Body -->
</div>

<app-modal #modal [modalConfig]="modalConfig">
  <form [formGroup]="clientForm" (ngSubmit)="submitForm()">
    <div class="row g-5 mb-6">
      <div class="form-group col-xs-12 col-sm-6">
        <label for="name" class="h6 required">Client Name</label>
        <input formControlName="name" type="text" class="form-control form-control-lg form-control-solid mb-1" id="name"
          placeholder="Enter item name">
        <span class="text-danger" *ngIf="clientForm.get('name')?.errors?.required && clientForm.get('name')?.touched">
          Name is required
        </span>
      </div>

      <div class="form-group col-xs-12 col-sm-6">
        <label for="tin" class="h6">TIN</label>
        <input formControlName="TIN" type="text" class="form-control form-control-lg form-control-solid mb-1" id="tin"
          placeholder="Enter TIN">
      </div>

      <div class="form-group col-xs-12 col-sm-6">
        <label for="contactPerson" class="h6">Contact Person</label>
        <input formControlName="contactPerson" type="text" class="form-control form-control-lg form-control-solid mb-1"
          id="contactPerson" placeholder="Enter contact person">
      </div>

      <div class="form-group col-xs-12 col-sm-6">
        <label for="primaryPhoneNumber" class="h6 required">Primary Phone Number</label>
        <input formControlName="primaryPhoneNumber" type="text"
          class="form-control form-control-lg form-control-solid mb-1" id="primaryPhoneNumber"
          placeholder="Enter primary phone number">
        <span class="text-danger"
          *ngIf="clientForm.get('primaryPhoneNumber')?.errors?.required && clientForm.get('primaryPhoneNumber')?.touched">
          Primary phone number is required
        </span>
      </div>

      <div class="form-group col-xs-12 col-sm-6">
        <label for="secondaryPhoneNumber" class="h6">Secondary Phone Number</label>
        <input formControlName="secondaryPhoneNumber" type="text"
          class="form-control form-control-lg form-control-solid mb-1" id="secondaryPhoneNumber"
          placeholder="Enter secondary phone number">
      </div>

      <div class="form-group col-xs-12 col-sm-6">
        <label for="email" class="h6">Email</label>
        <input formControlName="email" type="email" class="form-control form-control-lg form-control-solid mb-1"
          id="email" placeholder="Enter email">
      </div>

      <div class="form-group col-xs-12 col-sm-6">
        <label for="city" class="h6">City</label>
        <input formControlName="city" type="text" class="form-control form-control-lg form-control-solid mb-1" id="city"
          placeholder="Enter city">
      </div>

      <div class="form-group col-xs-12 col-sm-6">
        <label for="subCity" class="h6">Sub City</label>
        <input formControlName="subCity" type="text" class="form-control form-control-lg form-control-solid mb-1"
          id="subCity" placeholder="Enter sub city">
      </div>

      <div class="form-group col-xs-12 col-sm-6">
        <label for="woreda" class="h6">Woreda</label>
        <input formControlName="woreda" type="text" class="form-control form-control-lg form-control-solid mb-1"
          id="woreda" placeholder="Enter woreda">
      </div>

      <div class="form-group col-xs-12 col-sm-6">
        <label for="houseNumber" class="h6">House Number</label>
        <input formControlName="houseNumber" type="text" class="form-control form-control-lg form-control-solid mb-1"
          id="houseNumber" placeholder="Enter house number">
      </div>

      <div class="form-group col-xs-12">
        <label for="image" class="h6">Files</label>
        <input #fileInput type="file" class="form-control form-control-lg form-control-solid" id="image"
          placeholder="Select logo" (change)="onFileChange($event)" multiple>
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-outline-secondary" (click)="closeModal()">Close</button>
      <button type="submit" class="btn btn-outline-primary" [attr.data-kt-indicator]="submitLoading ? 'on' : 'off'">
        <span class="indicator-label">
          Submit
        </span>
        <span class="indicator-progress">
          Please wait... <span class="spinner-border spinner-border-sm align-middle ms-2"></span>
        </span>
      </button>
    </div>
  </form>
</app-modal>